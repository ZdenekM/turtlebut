<?xml version="1.0"?>
<launch>

  <group ns="dynamixel">

    <rosparam file="$(find tb_gazebo)/config/smart_arm_controllers.yaml" command="load" />

    <rosparam file="$(find tb_dynamixel)/config/dynamixel_joints.yaml" command="load"/>
    
    <!-- controller manager configuration -->
    <param name="pr2_controller_manager/mechanism_statistics_publish_rate" value="2.0" />
    <param name="pr2_controller_manager/joint_state_publish_rate" value="100.0" />

    <!-- Spawn some controllers stopped/started -->
    <node pkg="pr2_controller_manager" type="spawner" args="shoulder_pan_controller shoulder_pitch_controller elbow_flex_controller wrist_roll_controller left_finger_controller right_finger_controller kinect_controller" name="spawn_smart_arm" output="screen"/>
    
    <!-- It seems that JointPositionController and JointTrajectoryActionController could not be used at the same time!!! -->
    <!-- So we will use JointPositionController only for finger and for Kinect -->
    <!--node pkg="pr2_controller_manager" type="spawner" args="left_finger_controller right_finger_controller kinect_controller" name="spawn_smart_arm" output="screen"/-->

    <node pkg="pr2_mechanism_diagnostics" type="pr2_mechanism_diagnostics" name="pr2_mechanism_diagnostics" output="screen"/>
    
    <node pkg="tb_dynamixel" type="kinect_servo.py" name="kinect_servo" output="screen" respawn="false"/>
     
    <!-- node which can read and publish state of dynamixel joints -->
    <!--node name="dynamixel_joint_states_publisher" pkg="btb_dynamixel" type="joint_state_publisher.py" output="screen">
     <param name="rate" type="double" value="50"/>
    </node-->
    
    <!-- workaround for two finger in simulation, while real robot has only one (right finger) -->
    <node pkg="tb_gazebo" name="command_forwarder" type="dynamixel_command_forwarder.py" output="screen">
      <remap from="input_topic"  to="/dynamixel/right_finger_controller/command"/>
      <remap from="output_topic" to="/dynamixel/left_finger_controller/command"/>
    </node>
    
    <!-- another workaround - republishing state from controllers as JointState from dynamixel_msgs -->
    <node pkg="tb_gazebo" name="dynamixel_virtual_interface" type="dynamixel_virtual_interface.py" output="screen"/>
  
  </group>

</launch>
